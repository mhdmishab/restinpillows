<%- include ('../users/layout/header.ejs') %>


  <section class="h-100 h-custom container-fluid"
    style="background-image: url('/img/loginpic.jpg');  background-repeat: no-repeat; background-size: cover;">
    <div style="height: 7rem; width: 100%;"></div>
    <div class="container py-5 h-100">
      <div class="row d-flex justify-content-center align-items-center h-100">
        <div class="col-12">
          <div class="card card-registration card-registration-2" style="border-radius: 15px;">
            <div class="card-body p-0">
              <div class="row g-0">
                <div class="col-lg-8">
                  <div class="p-5">
                    <%if(productData){%>




                      <div class="d-flex justify-content-between align-items-center mb-5">
                        <h1 class="fw-bold mb-0 text-black">Shopping Cart</h1>
                        <h6 class="mb-0 text-muted">
                          <%=countCart %> items
                        </h6>
                      </div>

                      <% productData.forEach(element=> { %>
                        <hr class="my-4">


                        <div class="row mb-4 d-flex justify-content-between align-items-center">


                          <div class="col-md-2 col-lg-2 col-xl-2">
                            <img style="height: 3rem; width: 4rem;" src="/<%= element?.productDetail?.image[0]%>"
                              alt="">
                          </div>
                          <div class="col-md-3 col-lg-3 col-xl-3">
                            <h6 class="text-muted">
                              <%= element?.productDetail?.productname %>
                            </h6>
                            <h6 class="text-black mb-0"></h6>
                          </div>

                          <div class="col-md-3 col-lg-3 col-xl-2 d-flex">
                            <button type="button"
                              onclick="changeQuantity('<%= element._id %>','<%= element.productDetail._id %>',-1)"
                              class="form-control">-
                              <!-- <i class="ion-ios-remove"></i> -->
                            </button>
                            </span>
                            <input type="text" id="<%= element.productDetail._id %>" name="quantity"
                              class="quantity form-control input-number" value="<%= element.productQuantity%>" min="1"
                              max="100">
                            <span class="input-group-btn ml-2">
                              <button type="button"
                                onclick="changeQuantity('<%= element._id %>','<%= element.productDetail._id %>',1)"
                                class="form-control">+
                                <!-- <i class="ion-ios-add"></i> -->
                              </button>
                          </div>
                          <% var a=element.productDetail.price %>
                            <% var b=element.productQuantity %>
                              <% var c=a*b %>
                                <div class="col-md-3 col-lg-2 col-xl-2 offset-lg-1">
                                  <h6 class="mb-0" id="proprice">₹ <%= c %>
                                  </h6>
                                </div>
                                <div class="col-md-1 col-lg-1 col-xl-1 text-end">
                                  <a href="/removeproduct/<%= element._id%>/<%= element.productDetail._id%>"
                                    class="text-muted"><i class="fas fa-times"></i></a>
                                </div>
                        </div>

                        <% }) %>

                          <%}else{%>
                            <h1>NO products</h1>
                            <% } %>

                              <hr class="my-4">

                              <div class="pt-5">
                                <h6 class="mb-0"><a href="/" class="text-body"><i
                                      class="fas fa-long-arrow-alt-left me-2"></i>Back to shop</a></h6>
                              </div>
                  </div>
                </div>
                <div class="col-lg-4 bg-grey text-white">
                  <div class="p-5">
                    <h3 class="fw-bold mb-5 mt-2 pt-1">Summary</h3>
                    <hr class="my-4">

                    <div class="d-flex justify-content-between mb-4">
                      <h5 class="text-uppercase">items <%=countCart %>
                      </h5>
                      <h5 id="pricetotal">₹ <%=sum %>
                      </h5>
                    </div>

                    <h5 class="text-uppercase mb-3">Shipping</h5>

                    <div class="mb-4 pb-2">
                      <select class="form-control">
                        <option value="1">Standard-Delivery- €5.00</option>
                        <option value="2">Two</option>
                        <option value="3">Three</option>
                        <option value="4">Four</option>
                      </select>
                    </div>

                    <h5 class="text-uppercase mb-3">Give code</h5>

                    <div class="mb-5">
                      <div class="form-outline">
                        <input type="text" id="form3Examplea2" class="form-control form-control-lg" />
                        <label class="form-label" for="form3Examplea2">Enter your code</label>
                      </div>
                    </div>

                    <hr class="my-4">

                    <div class="d-flex justify-content-between mb-5">
                      <h5 class="text-uppercase">Total price</h5>
                      <h5 id="pricetotal">
                        <%=sum %>
                      </h5>
                    </div>

                    <button type="button" class="btn btn-dark btn-block btn-lg"
                      data-mdb-ripple-color="dark">Register</button>

                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </section>
  <div style="height: 8rem; width: 100%;"></div>





  <%- include ('../users/layout/footer.ejs') %>


    <script>



      // function changeQuantity(cartId, productId, count,quantity,price) {
      //   const requestOptions = {
      //     method: 'POST',
      //     headers: {
      //       'Content-Type': 'application/json'
      //     },
      //     body: JSON.stringify(
      //       {
      //         cart: cartId,
      //         product: productId,
      //         count: count,
      //       }
      //     )
      //   }

      //   fetch('/changequantity', requestOptions)
      //     .then((response) => {
      //       console.log("res is here");
      //       document.getElementById("proprice").innerHTML = Number(quantity*price)})
      //     .then((data) => {
      //       console.log("response in send then");
      //     })
      //     .catch((error) => {
      //       console.error(error)
      //     })
      // }




















      function changeQuantity(cartId, productId, count) {

        let quantity = parseInt(document.getElementById(productId).innerHTML);
        $.ajax({
          url: "/changequantity",
          data: {
            cart: cartId,
            product: productId,
            count: count,
          },
          method: "post",
          success: (response) => {
            // document.getElementById(productId).innerHTML = quantity + count;

            // document.getElementsByClassName('subtotal').innerText = response.sum


            location.reload();
          },
        });
      }

    </script>

    <%- include ('../users/layout/script.ejs') %>